const axios = a require("axios");
const cron = require("node-cron");

// --- ржоржбрж┐ржЙрж▓рзЗрж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ---
module.exports.config = {
    name: "azan",
    version: "1.0.0",
    hasPermssion: 2, // рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕрзНржпрж╛ржбржорж┐ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ
    credits: "sifat", // ржХрзНрж░рзЗржбрж┐ржЯрж╕
    description: "ржкрзНрж░рждрж┐ржжрж┐ржи рзл ржмрзЗрж▓рж╛ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ рж╕рзНржмрзЯржВржХрзНрж░рж┐рзЯржнрж╛ржмрзЗ ржорзЗрж╕рзЗржЬ ржжрж┐ржмрзЗ",
    commandCategory: "system",
    usages: "N/A",
    cooldowns: 5,
};

// --- ржмржЯ ржЪрж╛рж▓рзБ рж╣рж▓рзЗ ржПржЗ ржлрж╛ржВрж╢ржиржЯрж┐ ржХрж╛ржЬ ржХрж░ржмрзЗ ---
module.exports.onLoad = async function ({ api }) {
    
    // --- ржирж┐ржЬрзЗрж░ ржкрзНрж░рзЯрзЛржЬржи ржЕржирзБржпрж╛рзЯрзА ржПржЦрж╛ржирзЗ ржЖржЗржбрж┐ ржжрж┐ржи ---
    // ржпрзЗ ржЧрзНрж░рзБржк ржмрж╛ ржЪрзНржпрж╛ржЯрзЗ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛рждрзЗ ржЪрж╛ржи рждрж╛рж░ ржЖржЗржбрж┐ ржПржЦрж╛ржирзЗ ржжрж┐ржиред
    // ржПржХрж╛ржзрж┐ржХ ржЖржЗржбрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ, ржПржХржЯрж┐ ржЕрзНржпрж╛рж░рзЗ рждрзИрж░рж┐ ржХрж░рзЗ рж▓рзБржк ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
    // ржпрзЗржоржи: const threadIDs = ["ID1", "ID2"];
    const threadID = "YOUR_THREAD_ID"; // <<<<<<<<<<<< ржПржЦрж╛ржирзЗ ржЖржкржирж╛рж░ ржЧрзНрж░рзБржк ржмрж╛ ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐ ржжрж┐ржи

    // --- ржкрзНрж░рждрж┐ржжрж┐ржирзЗрж░ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯрж╕рзВржЪрзА ---
    let prayerTimes = {};

    // --- ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржирж┐рзЯрзЗ ржЖрж╕рж╛рж░ ржлрж╛ржВрж╢ржи ---
    async function getPrayerTimes() {
        try {
            // ржврж╛ржХрж╛, ржмрж╛ржВрж▓рж╛ржжрзЗрж╢-ржПрж░ ржЬржирзНржп ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржЖржирж╛ рж╣ржЪрзНржЫрзЗред
            const response = await axios.get("http://api.aladhan.com/v1/timingsByCity", {
                params: {
                    city: "Dhaka",
                    country: "Bangladesh",
                    method: 1 // University of Islamic Sciences, Karachi
                }
            });
            // рж╢рзБржзрзБржорж╛рждрзНрж░ рзл ржУрзЯрж╛ржХрзНржд ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржирзЗржУрзЯрж╛ рж╣ржЪрзНржЫрзЗред
            const times = response.data.data.timings;
            prayerTimes = {
                Fajr: times.Fajr,
                Dhuhr: times.Dhuhr,
                Asr: times.Asr,
                Maghrib: times.Maghrib,
                Isha: times.Isha
            };
            console.log("ржЖржЬржХрзЗрж░ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ рж╕ржлрж▓ржнрж╛ржмрзЗ рж▓рзЛржб рж╣рзЯрзЗржЫрзЗ:", prayerTimes);
        } catch (error) {
            console.error("ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржЖржирждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ:", error);
        }
    }

    // --- ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзи:рзжрзз ржорж┐ржирж┐ржЯрзЗ ржирждрзБржи ржжрж┐ржирзЗрж░ рж╕ржорзЯрж╕рзВржЪрзА рж▓рзЛржб ржХрж░ржмрзЗ ---
    cron.schedule('1 0 * * *', () => {
        console.log("ржирждрзБржи ржжрж┐ржирзЗрж░ ржЬржирзНржп ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...");
        getPrayerTimes();
    }, {
        scheduled: true,
        timezone: "Asia/Dhaka"
    });

    // --- ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ рж╕ржорзЯ ржЪрзЗржХ ржХрж░рж╛рж░ ржЬржирзНржп ржХрзНрж░рзЛржи ржЬржм ---
    cron.schedule('* * * * *', () => {
        const now = new Date();
        const currentTime = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: "Asia/Dhaka" });
        
        // --- ржУрзЯрж╛ржХрзНржд ржЕржирзБржпрж╛рзЯрзА ржорзЗрж╕рзЗржЬ ---
        let prayerName = "";
        let message = "";

        if (currentTime === prayerTimes.Fajr) {
            prayerName = "ржлржЬрж░рзЗрж░";
            message = `ЁЯХЛ ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржоред\n\nржПржЦржи ${prayerName} ржЖржпрж╛ржирзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗред ржЖрж▓рзНрж▓рж╛рж╣ ржЖржорж╛ржжрзЗрж░ рж╕ржмрж╛ржЗржХрзЗ ржирж╛ржорж╛ржЬ ржЖржжрж╛рзЯ ржХрж░рж╛рж░ рждрзМржлрж┐ржХ ржжрж╛ржи ржХрж░рзБржиред`;
        } else if (currentTime === prayerTimes.Dhuhr) {
            prayerName = "ржпрзЛрж╣рж░рзЗрж░";
            message = `ЁЯХЛ ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржоред\n\nржПржЦржи ${prayerName} ржЖржпрж╛ржирзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗред ржжрзБржирж┐рзЯрж╛рж░ рж╕ржм ржХрж╛ржЬ ржлрзЗрж▓рзЗ ржирж╛ржорж╛ржЬ ржЖржжрж╛рзЯ ржХрж░рзЗ ржирж┐ржиред`;
        } else if (currentTime === prayerTimes.Asr) {
            prayerName = "ржЖрж╕рж░рзЗрж░";
            message = `ЁЯХЛ ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржоред\n\nржПржЦржи ${prayerName} ржЖржпрж╛ржирзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗред ржЖрж▓рзНрж▓рж╛рж╣ ржЖржкржирж╛рж░ ржкрзНрж░рж╛рж░рзНржержирж╛ ржХржмрзБрж▓ ржХрж░рзБржиред`;
        } else if (currentTime === prayerTimes.Maghrib) {
            prayerName = "ржорж╛ржЧрж░рж┐ржмрзЗрж░";
            message = `ЁЯХЛ ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржоред\n\nржПржЦржи ${prayerName} ржЖржпрж╛ржирзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗред ржорж╣рж╛ржи ржЖрж▓рзНрж▓рж╛рж╣ ржЖржорж╛ржжрзЗрж░ ржЙржкрж░ рж░рж╣ржоржд ржмрж░рзНрж╖ржг ржХрж░рзБржиред`;
        } else if (currentTime === prayerTimes.Isha) {
            prayerName = "ржЗрж╢рж╛рж░";
            message = `ЁЯХЛ ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржоред\n\nржПржЦржи ${prayerName} ржЖржпрж╛ржирзЗрж░ рж╕ржорзЯ рж╣рзЯрзЗржЫрзЗред ржжрж┐ржирзЗрж░ рж╢рзЗрж╖ ржирж╛ржорж╛ржЬ ржЖржжрж╛рзЯ ржХрж░рзЗ ржЖрж▓рзНрж▓рж╛рж╣рж░ ржХрж╛ржЫрзЗ ржХрзНрж╖ржорж╛ ржкрзНрж░рж╛рж░рзНржержирж╛ ржХрж░рзБржиред`;
        }

        // --- ржпржжрж┐ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржмрзЗ ---
        if (message) {
            api.sendMessage(message, threadID, (err) => {
                if (err) console.error("ржЖржЬрж╛ржирзЗрж░ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ:", err);
                else console.log(`${prayerName} ржирж╛ржорж╛ржЬрзЗрж░ ржЬржирзНржп рж╕ржлрж▓ржнрж╛ржмрзЗ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗржЫрзЗред`);
            });
        }

    }, {
        scheduled: true,
        timezone: "Asia/Dhaka"
    });

    // ржмржЯ ржЪрж╛рж▓рзБ рж╣ржУрзЯрж╛рж░ рж╕рж╛ржерзЗ рж╕рж╛ржерзЗ ржкрзНрж░ржержоржмрж╛рж░ ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ рж▓рзЛржб ржХрж░ржмрзЗ
    getPrayerTimes();
}

// --- ржПржЗ ржХржорж╛ржирзНржбрзЗрж░ ржЬржирзНржп ржХрзЛржирзЛ рж░рж╛ржи ржлрж╛ржВрж╢ржи ржирзЗржЗ, ржХрж╛рж░ржг ржПржЯрж┐ рж╕рзНржмрзЯржВржХрзНрж░рж┐рзЯ ---
module.exports.run = async function ({ api, event }) {
    api.sendMessage("ржПржЯрж┐ ржПржХржЯрж┐ рж╕рзНржмрзЯржВржХрзНрж░рж┐рзЯ ржоржбрж┐ржЙрж▓ред ржкрзНрж░рждрж┐ржжрж┐ржи ржирж╛ржорж╛ржЬрзЗрж░ рж╕ржорзЯ рж╣рж▓рзЗ ржПржЯрж┐ ржирж┐ржЬрзЗ ржерзЗржХрзЗржЗ ржорзЗрж╕рзЗржЬ ржжрж┐ржмрзЗред", event.threadID, event.messageID);
};
